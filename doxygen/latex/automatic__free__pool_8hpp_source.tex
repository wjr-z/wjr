\doxysection{automatic\+\_\+free\+\_\+pool.\+hpp}
\hypertarget{automatic__free__pool_8hpp_source}{}\label{automatic__free__pool_8hpp_source}\index{include/wjr/memory/automatic\_free\_pool.hpp@{include/wjr/memory/automatic\_free\_pool.hpp}}
\mbox{\hyperlink{automatic__free__pool_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ WJR\_MEMORY\_AUTOMATIC\_FREE\_POOL\_HPP\_\_}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ WJR\_MEMORY\_AUTOMATIC\_FREE\_POOL\_HPP\_\_}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{list_8hpp}{wjr/container/list.hpp}}>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{aligned__alloc_8hpp}{wjr/memory/aligned\_alloc.hpp}}>}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacewjr}{wjr}}\ \{}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00016\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classwjr_1_1automatic__free__pool}{automatic\_free\_pool}}\ \{}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keyword}{struct\ }chunk\ :\ \mbox{\hyperlink{structwjr_1_1intrusive_1_1list__node}{intrusive::list\_node}}<chunk>\ \{\};}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classwjr_1_1automatic__free__pool_ab3f81deaba34b75a82156f7ffdf817b6}{aligned\_header\_size}}\ =\ \mbox{\hyperlink{namespacewjr_a0639d5380f909615f7ca58e6dc61edc3}{align\_up}}(\textcolor{keyword}{sizeof}(chunk),\ \mbox{\hyperlink{namespacewjr_1_1mem_a940d9c0863da02f641b02ec9ee02417a}{mem::default\_new\_alignment}});}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \ \ \ \ \mbox{\hyperlink{classwjr_1_1automatic__free__pool_a4cb2a66346f24f1e5406a4e5739fc04d}{automatic\_free\_pool}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00023\ \ \ \ \ \mbox{\hyperlink{classwjr_1_1automatic__free__pool_a82a0139c586f4b468f9df542e76b4234}{\string~automatic\_free\_pool}}()\ \mbox{\hyperlink{namespacewjr_af89e8e658fd9c3a3b154c55677a3b528}{noexcept}}\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ chunk\ *\mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{node}},\ *next;}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{WJR\_LIST\_FOR\_EACH\_ENTRY\_SAFE}}(\mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{node}},\ next,\ \&head)\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ mem::\_\_default\_deallocate<>(\mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{node}},\ std::nothrow);}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00028\ \ \ \ \ \}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \mbox{\hyperlink{classwjr_1_1automatic__free__pool_a2b36d8dc3b416ed533856e3caf2fa980}{automatic\_free\_pool}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classwjr_1_1automatic__free__pool}{automatic\_free\_pool}}\ \&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00031\ \ \ \ \ \mbox{\hyperlink{classwjr_1_1automatic__free__pool_a5f5cfc2534ed8ef4e30d7e855d3526fd}{automatic\_free\_pool}}(\mbox{\hyperlink{classwjr_1_1automatic__free__pool}{automatic\_free\_pool}}\ \&\&other)\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ replace(\&other.head,\ \&head);}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ other.head.init\_self();}
\DoxyCodeLine{00034\ \ \ \ \ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{classwjr_1_1automatic__free__pool}{automatic\_free\_pool}}\ \&\mbox{\hyperlink{classwjr_1_1automatic__free__pool_a4051a2c8e360dbefab1302146b54e216}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classwjr_1_1automatic__free__pool}{automatic\_free\_pool}}\ \&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{classwjr_1_1automatic__free__pool}{automatic\_free\_pool}}\ \&\mbox{\hyperlink{classwjr_1_1automatic__free__pool_a35210d62439f3a94dbe692ca83f1de35}{operator=}}(\mbox{\hyperlink{classwjr_1_1automatic__free__pool}{automatic\_free\_pool}}\ \&\&other)\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ chunk\ *\mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{node}},\ *next;}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{WJR\_LIST\_FOR\_EACH\_ENTRY\_SAFE}}(\mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{node}},\ next,\ \&head)\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ mem::\_\_default\_deallocate<>(\mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{node}},\ std::nothrow);}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ replace(\&other.head,\ \&head);}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ other.head.init\_self();}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00045\ \ \ \ \ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{WJR\_MALLOC}}\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{classwjr_1_1automatic__free__pool_a7e68a93b22913c19b832324ebe91556d}{allocate}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{include_2wjr_2arch_2x86_2biginteger_2detail_2gen__addrsblsh__n_8hpp_a42a1da88df05bc933612820bb42db3a2}{n}})\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ *\textcolor{keyword}{const}\ raw\ =\ mem::\_\_default\_allocate<>(\mbox{\hyperlink{include_2wjr_2arch_2x86_2biginteger_2detail_2gen__addrsblsh__n_8hpp_a42a1da88df05bc933612820bb42db3a2}{n}}\ +\ \mbox{\hyperlink{classwjr_1_1automatic__free__pool_ab3f81deaba34b75a82156f7ffdf817b6}{aligned\_header\_size}},\ std::nothrow);}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ head.\mbox{\hyperlink{classwjr_1_1intrusive_1_1list__node__base_aed9c08fe5dddca2896da1896fa03ceea}{push\_back}}(\textcolor{keyword}{static\_cast<}chunk\ *\textcolor{keyword}{>}(raw));}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{void}\ *\textcolor{keyword}{>}(\textcolor{keyword}{static\_cast<}std::byte\ *\textcolor{keyword}{>}(raw)\ +\ \mbox{\hyperlink{classwjr_1_1automatic__free__pool_ab3f81deaba34b75a82156f7ffdf817b6}{aligned\_header\_size}});}
\DoxyCodeLine{00051\ \ \ \ \ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwjr_1_1automatic__free__pool_a564a8408e0402fc781ad81326cb6acd0}{deallocate}}(\textcolor{keywordtype}{void}\ *ptr)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ *\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{node}}\ =\ \textcolor{keyword}{static\_cast<}std::byte\ *\textcolor{keyword}{>}(ptr)\ -\/\ \mbox{\hyperlink{classwjr_1_1automatic__free__pool_ab3f81deaba34b75a82156f7ffdf817b6}{aligned\_header\_size}};}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keyword}{reinterpret\_cast<}chunk\ *\textcolor{keyword}{>}(\mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{node}})-\/>remove();}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ mem::\_\_default\_deallocate<>(\mbox{\hyperlink{namespacewjr_a1acbd863328d678d9e25f3a31ef82df0}{node}},\ std::nothrow);}
\DoxyCodeLine{00057\ \ \ \ \ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00060\ \ \ \ \ chunk\ head;}
\DoxyCodeLine{00061\ \};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \}\ \textcolor{comment}{//\ namespace\ wjr}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ WJR\_MEMORY\_AUTOMATIC\_FREE\_POOL\_HPP\_\_}}

\end{DoxyCode}
